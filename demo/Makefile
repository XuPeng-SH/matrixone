# AI Dataset Demo Makefile

.PHONY: help build run interactive clean test sql

# é»˜è®¤ç›®æ ‡
help:
	@echo "AI Dataset Demo - Available Commands:"
	@echo "======================================"
	@echo "make build        - æ„å»ºæ¼”ç¤ºç¨‹åº"
	@echo "make run          - è¿è¡Œå®Œæ•´æ¼”ç¤º"
	@echo "make run-host     - è¿è¡Œæ¼”ç¤ºï¼ˆæŒ‡å®š hostï¼‰"
	@echo "make interactive  - è¿è¡Œäº¤äº’å¼æ¼”ç¤º"
	@echo "make interactive-host - è¿è¡Œäº¤äº’å¼æ¼”ç¤ºï¼ˆæŒ‡å®š hostï¼‰"
	@echo "make sql          - æ‰§è¡Œ SQL æ¼”ç¤ºè„šæœ¬"
	@echo "make test         - è¿è¡Œæµ‹è¯•"
	@echo "make clean        - æ¸…ç†æ„å»ºæ–‡ä»¶"
	@echo "make help         - æ˜¾ç¤ºæ­¤å¸®åŠ©ä¿¡æ¯"
	@echo ""
	@echo "é…ç½®é€‰é¡¹:"
	@echo "  HOST=192.168.1.100 PORT=6001 USER=root PASSWORD=111 DATABASE=test"
	@echo ""
	@echo "ç¯å¢ƒå˜é‡:"
	@echo "  MO_HOST, MO_PORT, MO_USER, MO_PASSWORD, MO_DATABASE"
	@echo ""
	@echo "å‘½ä»¤è¡Œå‚æ•°:"
	@echo "  -host, -port, -user, -password, -database, -dsn, -interactive"

# æ„å»ºæ¼”ç¤ºç¨‹åº
build:
	@echo "ğŸ”¨ Building AI Dataset Demo..."
	go mod tidy
	go build -o ai_dataset_demo .
	# Interactive demo is now built into the main binary
	@echo "âœ… Build completed!"

# è¿è¡Œå®Œæ•´æ¼”ç¤º
run: build
	@echo "ğŸ¬ Running AI Dataset Demo..."
	@if ! nc -z 127.0.0.1 6001; then \
		echo "âŒ MatrixOne is not running on port 6001"; \
		echo "Please start MatrixOne first:"; \
		echo "  ./mo-service -cfg etc/launch/launch.toml"; \
		exit 1; \
	fi
	@echo "âœ… MatrixOne is running"
	@./ai_dataset_demo

# è¿è¡Œæ¼”ç¤ºï¼ˆæŒ‡å®š hostï¼‰
run-host: build
	@echo "ğŸ¬ Running AI Dataset Demo with custom host..."
	@./ai_dataset_demo -host $(HOST) -port $(PORT) -user $(USER) -password $(PASSWORD) -database $(DATABASE)

# è¿è¡Œäº¤äº’å¼æ¼”ç¤º
interactive: build
	@echo "ğŸ® Starting Interactive Demo..."
	@if ! nc -z 127.0.0.1 6001; then \
		echo "âŒ MatrixOne is not running on port 6001"; \
		echo "Please start MatrixOne first:"; \
		echo "  ./mo-service -cfg etc/launch/launch.toml"; \
		exit 1; \
	fi
	@echo "âœ… MatrixOne is running"
	@./ai_dataset_demo -interactive

# è¿è¡Œäº¤äº’å¼æ¼”ç¤ºï¼ˆæŒ‡å®š hostï¼‰
interactive-host: build
	@echo "ğŸ® Starting Interactive Demo with custom host..."
	@./ai_dataset_demo -interactive -host $(HOST) -port $(PORT) -user $(USER) -password $(PASSWORD) -database $(DATABASE)

# æ‰§è¡Œ SQL æ¼”ç¤ºè„šæœ¬
sql:
	@echo "ğŸ“Š Executing SQL Demo Script..."
	@if ! nc -z 127.0.0.1 6001; then \
		echo "âŒ MatrixOne is not running on port 6001"; \
		echo "Please start MatrixOne first:"; \
		echo "  ./mo-service -cfg etc/launch/launch.toml"; \
		exit 1; \
	fi
	@echo "âœ… MatrixOne is running"
	@mysql -h 127.0.0.1 -P 6001 -u root -p111 test < demo_queries.sql

# è¿è¡Œæµ‹è¯•
test:
	@echo "ğŸ§ª Running tests..."
	go test -v ./...

# æ¸…ç†æ„å»ºæ–‡ä»¶
clean:
	@echo "ğŸ§¹ Cleaning build files..."
	rm -f ai_dataset_demo interactive_demo
	go clean
	@echo "âœ… Clean completed!"

# æ£€æŸ¥ä¾èµ–
deps:
	@echo "ğŸ“¦ Checking dependencies..."
	go mod verify
	go mod tidy

# æ ¼å¼åŒ–ä»£ç 
fmt:
	@echo "ğŸ¨ Formatting code..."
	go fmt ./...

# ä»£ç æ£€æŸ¥
lint:
	@echo "ğŸ” Running linter..."
	@if command -v golangci-lint >/dev/null 2>&1; then \
		golangci-lint run; \
	else \
		echo "âš ï¸  golangci-lint not installed, skipping linting"; \
	fi

# å®‰è£…ä¾èµ–
install-deps:
	@echo "ğŸ“¥ Installing dependencies..."
	go mod download
	@echo "âœ… Dependencies installed!"

# å¿«é€Ÿå¯åŠ¨ï¼ˆæ£€æŸ¥ç¯å¢ƒå¹¶è¿è¡Œæ¼”ç¤ºï¼‰
quickstart: build
	@echo "ğŸš€ Quick Start - AI Dataset Demo"
	@echo "================================="
	@if ! nc -z 127.0.0.1 6001; then \
		echo "âŒ MatrixOne is not running on port 6001"; \
		echo "Please start MatrixOne first:"; \
		echo "  ./mo-service -cfg etc/launch/launch.toml"; \
		exit 1; \
	fi
	@echo "âœ… MatrixOne is running"
	@echo "ğŸ¬ Starting demo in 3 seconds..."
	@sleep 3
	@export MO_DSN="root:111@tcp(127.0.0.1:6001)/test" && ./ai_dataset_demo

# å¼€å‘æ¨¡å¼ï¼ˆè‡ªåŠ¨é‡æ–°æ„å»ºå’Œè¿è¡Œï¼‰
dev:
	@echo "ğŸ”„ Development mode - watching for changes..."
	@if command -v air >/dev/null 2>&1; then \
		air; \
	else \
		echo "âš ï¸  air not installed, falling back to manual build"; \
		make build && make run; \
	fi
